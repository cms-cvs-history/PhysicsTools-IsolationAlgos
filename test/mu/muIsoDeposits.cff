#pieces needed to run the associator-related stuff
include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cff"
include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"
include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"
include "TrackPropagation/SteppingHelixPropagator/data/SteppingHelixPropagatorAny.cfi"
include "TrackingTools/TrackAssociator/data/DetIdAssociatorESProducer.cff" 

include "RecoMuon/MuonIsolationProducers/data/trackExtractorBlocks.cff"
include "RecoMuon/MuonIsolationProducers/data/caloExtractorByAssociatorBlocks.cff"
include "RecoMuon/MuonIsolationProducers/data/jetExtractorBlock.cff"
include "RecoMuon/MuonIsolationProducers/data/caloExtractorBlocks.cff"


#candIsoDeposit from tracks for muons; make distinct names for tracker and global muons
module muIsoDepositTk 
       = candIsoDepositCtfTk from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositCtfTk.cfi"
replace muIsoDepositTk.src = muons
replace muIsoDepositTk.trackType = "best"
#will read generalTracks here
replace muIsoDepositTk.ExtractorPSet = { using MIsoTrackExtractorBlock }


#candIsoDeposit maker for muons based on TrackAssociator using towers
module muIsoDepositCalByAssociatorTowers 
       = candIsoDepositCalByAssociatorTowers from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositCalByAssociatorTowers.cfi"
replace muIsoDepositCalByAssociatorTowers.src = muons
replace muIsoDepositCalByAssociatorTowers.trackType = "best"
#can't write this here, since there was a replace during config :(
#replace muIsoDepositCalByAssociatorTowers.ExtractorPSet = { using MIsoCaloExtractorByAssociatorTowersBlock }

#candIsoDeposit maker for  and muons based on TrackAssociator using rec-hits
module muIsoDepositCalByAssociatorHits 
       = candIsoDepositCalByAssociatorHits from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositCalByAssociatorHits.cfi"
replace muIsoDepositCalByAssociatorHits.src = muons
replace muIsoDepositCalByAssociatorHits.trackType = "best"
#can't write this here, since there was a replace during config :(
#replace muIsoDepositCalByAssociatorHits.ExtractorPSet = { using MIsoCaloExtractorByAssociatorHitsBlock }

#candIsoDeposit maker for muons based on TrackAssociator using towers
module muIsoDepositJets 
       = candIsoDepositJets from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositJets.cfi"
replace muIsoDepositJets.src = muons
replace muIsoDepositJets.trackType = "best"
#can't write this here, since there was a replace during config :(
#replace muIsoDepositJets.ExtractorPSet  = { using MIsoJetExtractorBlock }

#Ecal-only candIsoDeposit using CaloExtractor for 
module muIsoDepositCalEcal = candIsoDepositCal from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositCal.cfi"
replace muIsoDepositCalEcal.src = muons
replace muIsoDepositCalEcal.trackType = "best"
replace muIsoDepositCalEcal.ExtractorPSet = { using MIsoCaloExtractorEcalBlock }


#Hcal-only candIsoDeposit using CaloExtractor for 
module muIsoDepositCalHcal = candIsoDepositCal from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositCal.cfi"
replace muIsoDepositCalHcal.src = muons
replace muIsoDepositCalHcal.trackType = "best"
replace muIsoDepositCalHcal.ExtractorPSet = { using MIsoCaloExtractorHcalBlock }


##########################################################################
# and now sequences of the above
##########################################################################
# "standard sequence"
sequence muIsoDeposits = {
  muIsoDepositTk & 
  muIsoDepositCalByAssociatorTowers & 
  muIsoDepositJets
}
