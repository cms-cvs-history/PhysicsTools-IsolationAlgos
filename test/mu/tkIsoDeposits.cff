#pieces needed to run the associator-related stuff
include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cff"
include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"
include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"
include "TrackPropagation/SteppingHelixPropagator/data/SteppingHelixPropagatorAny.cfi"
include "TrackingTools/TrackAssociator/data/DetIdAssociatorESProducer.cff" 

include "RecoMuon/MuonIsolationProducers/data/trackExtractorBlocks.cff"
include "RecoMuon/MuonIsolationProducers/data/caloExtractorByAssociatorBlocks.cff"
include "RecoMuon/MuonIsolationProducers/data/jetExtractorBlock.cff"
include "RecoMuon/MuonIsolationProducers/data/caloExtractorBlocks.cff"


include "PhysicsTools/RecoAlgos/data/goodTracks.cfi"
replace goodTracks.src = generalTracks
replace goodTracks.cut = "pt > 20"

module tkIsoDepositTk 
       = candIsoDepositCtfTk from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositCtfTk.cfi"
replace tkIsoDepositTk.src = goodTracks
replace tkIsoDepositTk.trackType = "best"
#will read generalTracks here
replace tkIsoDepositTk.ExtractorPSet = { using MIsoTrackExtractorBlock }


#candIsoDeposit maker for goodTracks based on TrackAssociator using towers
module tkIsoDepositCalByAssociatorTowers 
       = candIsoDepositCalByAssociatorTowers from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositCalByAssociatorTowers.cfi"
replace tkIsoDepositCalByAssociatorTowers.src = goodTracks
replace tkIsoDepositCalByAssociatorTowers.trackType = "best"

#candIsoDeposit maker for goodTracks based on TrackAssociator using rec-hits
module tkIsoDepositCalByAssociatorHits 
       = candIsoDepositCalByAssociatorHits from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositCalByAssociatorHits.cfi"
replace tkIsoDepositCalByAssociatorHits.src = goodTracks
replace tkIsoDepositCalByAssociatorHits.trackType = "best"

#candIsoDeposit maker for goodTracks based on TrackAssociator using towers
module tkIsoDepositJets 
       = candIsoDepositJets from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositJets.cfi"
replace tkIsoDepositJets.src = goodTracks
replace tkIsoDepositJets.trackType = "best"

#Ecal-only candIsoDeposit using CaloExtractor for 
module tkIsoDepositCalEcal = candIsoDepositCal from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositCal.cfi"
replace tkIsoDepositCalEcal.src = goodTracks
replace tkIsoDepositCalEcal.trackType = "best"
replace tkIsoDepositCalEcal.ExtractorPSet = { using MIsoCaloExtractorEcalBlock }


#Hcal-only candIsoDeposit using CaloExtractor for 
module tkIsoDepositCalHcal = candIsoDepositCal from "PhysicsTools/IsolationAlgos/test/mu/candIsoDepositCal.cfi"
replace tkIsoDepositCalHcal.src = goodTracks
replace tkIsoDepositCalHcal.trackType = "best"
replace tkIsoDepositCalHcal.ExtractorPSet = { using MIsoCaloExtractorHcalBlock }


##########################################################################
# and now sequences of the above
##########################################################################
# "standard sequence"
sequence tkIsoDeposits = {
  goodTracks &
  tkIsoDepositTk & 
  tkIsoDepositCalByAssociatorTowers & 
  tkIsoDepositJets
}
